<html class="page-31 app-IMIM" lang="en" style="--js-sticky-top: 204.4px;">

<head>
  <meta http-equiv="x-ua-compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>District, Financial year, System, Quarter</title>

  <link rel="apple-touch-icon" href="../assets/img/app-icon-192.png">
  <link rel="icon" href="../assets/img/app-icon-32.png">

  <link rel="stylesheet" href="../assets/css/Core.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/Theme-Standard.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/font-apex.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/Core_theme.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/custom.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/aos.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/theme.css" type="text/css">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/datatable/css/dataTables.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/vendor/datatable/dataTables.bootstrap5.min.css">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

  <style type="text/css">
    .a-Menu--top.submenu {
      position: absolute;
      /* Make submenu appear outside of parent li */
      top: 100%;
      /* Place submenu right below parent */
      left: 0;
      /* Align submenu with parent */
      min-width: 200px;
      /* Adjust width if needed */
      background: white;
      /* Ensure it has a background */
      border: 1px solid #ccc;
      /* Add a border for visibility */
      z-index: 1000;
      /* Ensure it appears above other elements */
      display: none;
      /* Initially hidden */
    }

    .cusdrop {
      top: 13.5rem;
      left: initial !important;
    }

    .navpage {
      height: 100%;
      text-decoration: none;
      color: #fff;
      padding: 12px;
      line-height: 3.2;
    }

    .a-MenuBar-item a {
      display: block;
      width: 100%;
      height: 100%;
      text-decoration: none;
      color: inherit;
    }
  </style>

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body
  class="t-PageBody t-PageBody--hideLeft t-PageBody--hideActions t-PageTemplate--standard apex-top-nav apex-icons-fontapex apex-theme-vita-standard js-HeaderExpanded t-PageBody--topNav"
  id="t_PageBody" data-aos-easing="ease" data-aos-duration="400" data-aos-delay="0">
  <a href="#main" id="t_Body_skipToContent">Skip to Main Content</a>
  <form>
    <header class="t-Header" id="t_Header" role="banner">
      <div class="t-Header-branding">
        <div class="t-Header-controls">
          <button class="t-Button t-Button--icon t-Button--header t-Button--headerTree" aria-label="Main Navigation"
            title="Main Navigation" id="t_Button_navControl" type="button"><span class="t-Header-controlsIcon"
              aria-hidden="true"></span></button>
        </div>
        <div class="t-Header-logo">
          <!-- <a href="&#x2F;ords&#x2F;r&#x2F;dimdev&#x2F;imim&#x2F;home?session=7587523802442" class="t-Header-logo-link"><img src="r&#x2F;dimdev&#x2F;117&#x2F;files&#x2F;static&#x2F;v194&#x2F;app-251298-logo.jpeg" alt="" class="apex-logo-img" /><span class="apex-logo-text">DIRECTORATE OF INDIAN MEDICINE  - INDENT MANAGEMENT</span></a> -->
          <div class="gigw">
            <li><a data-aos="fade-up" data-aos-delay="200" class="linkedin btn-decrease aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="font size Decrease"><i></i> A
                  -</span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="300" class="linkedin btn-orig aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Reset font"><i></i> A
                  <sup></sup></span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="400" class="instagram btn-increase aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="font size Increase"><i></i> A
                  +</span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="500" class="aos-init aos-animate"><span class="d-inline-block"
                  tabindex="0" data-toggle="tooltip" title="Dark Mode"><i class="t-Icon fa fa-moon-o"
                    id="darkmode"></i></span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="600" class="form-check form-switch aos-init aos-animate"><label
                  class="form-check-label" for="screenReaderSwitch">
                  <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Screen Reader">
                    <i id="sound" class="t-Icon fa fa-volume-up"></i></span></label><input class="form-check-input"
                  type="checkbox" role="switch" id="screenReaderSwitch"
                  onclick="readText(document.getElementsByTagName('body')[0])"></a>
            </li>
          </div>
        </div>
        <div class="t-Header-navBar">
          <div class="t-Header-navBar--start"></div>
          <div id="globalHeader"></div>
          <div class="t-Header-navBar--end"></div>
        </div>
      </div>
      <div class="top">
        <img id="leftlogo" data-aos="fade-right" data-aos-duration="800" src="../assets/img/head-tnlogo.png"
          class="aos-init aos-animate">
        <h1 data-aos="zoom-in" data-aos-duration="800" class="dept-name text-middle aos-init aos-animate">Medicine
          Indent</h1>
        <h3 data-aos="zoom-in" data-aos-duration="800" class="dept-name2 text-middle aos-init aos-animate">Department of
          Indian Medicine and Homoeopathy</h3>
        <img id="rightlogo" data-aos="fade-left" data-aos-duration="800" src="../assets/img/head-dept-logo.png"
          class="aos-init aos-animate">
      </div>
      <div class="t-Header-nav">
        <div class="t-Header-nav-list js-tabLike js-tabLike a-MenuBar a-MenuBar--overflow a-MenuBar--tabs"
          id="t_MenuNav" role="menubar">
          <ul id="nav-links">
            <div id="navbar-container"></div>
          </ul>
        </div>
      </div>
    </header>
    <div class="t-Body">
      <div class="t-Body-main">
        <div class="t-Body-title" id="t_Body_title"></div>
        <div class="t-Body-content" id="t_Body_content">
          <div id="t_Body_content_offset"></div>
          <main id="main" class="t-Body-mainContent">
            <span id="APEX_SUCCESS_MESSAGE" data-template-id="238562751400702882270_S"
              class="apex-page-success u-hidden"></span><span id="APEX_ERROR_MESSAGE"
              data-template-id="238562751400702882270_E" class="apex-page-error u-hidden"></span>
            <div class="t-Body-fullContent"></div>
            <div class="t-Body-contentInner">
              <div class="container">
                <div class="row ">
                  <div class="col col-6 apex-col-auto col-start">
                    <div
                      class="t-Form-fieldContainer is-required rel-col t-Form-fieldContainer--stretchInputs t-Form-fieldContainer--indicatorAsterisk t-Form-fieldContainer--large apex-item-wrapper apex-item-wrapper--select-list"
                      id="P31_DISTRICT_CONTAINER">
                      <div class="t-Form-labelContainer col col-2">
                        <label for="P31_DISTRICT" id="P31_DISTRICT_LABEL" class="t-Form-label">District
                        </label>
                      </div>
                      <div class="t-Form-inputContainer col col-4">
                        <div class="t-Form-itemWrapper">
                          <select id="P31_DISTRICT" name="P31_DISTRICT" required="" class="selectlist apex-item-select"
                            data-native-menu="false" size="1">

                          </select>
                        </div>
                        <div class="t-Form-itemAssistance">
                          <span id="P31_DISTRICT_error_placeholder" class="a-Form-error"
                            data-template-id="428237131064519931341_ET"></span>
                          <div class="t-Form-itemRequired" aria-hidden="true">Required</div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col col-6 apex-col-auto col-end">
                    <div
                      class="t-Form-fieldContainer is-required rel-col t-Form-fieldContainer--stretchInputs t-Form-fieldContainer--indicatorAsterisk t-Form-fieldContainer--large apex-item-wrapper apex-item-wrapper--select-list"
                      id="P31_FINANCIAL_YEAR_CONTAINER">
                      <div class="t-Form-labelContainer col col-2">
                        <label for="P31_FINANCIAL_YEAR" id="P31_FINANCIAL_YEAR_LABEL" class="t-Form-label">Financial
                          Year </label>
                      </div>
                      <div class="t-Form-inputContainer col col-4">
                        <div class="t-Form-itemWrapper">
                          <select id="P31_FINANCIAL_YEAR" name="P31_FINANCIAL_YEAR" required=""
                            class="selectlist apex-item-select" data-native-menu="false" size="1">
                            <option value="" selected="selected"></option>
                            <option value="2023 - 2024">2023 - 2024</option>
                            <option value="2024 - 2025">2024 - 2025</option>
                            <option value="2025 - 2026">2025 - 2026</option>
                            <option value="2022 - 2023">2022 - 2023</option>
                          </select>
                        </div>
                        <div class="t-Form-itemAssistance">
                          <span id="P31_FINANCIAL_YEAR_error_placeholder" class="a-Form-error"
                            data-template-id="428237131064519931341_ET"></span>
                          <div class="t-Form-itemRequired" aria-hidden="true">Required</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row ">
                  <div class="col col-6 apex-col-auto col-start">
                    <div
                      class="t-Form-fieldContainer rel-col t-Form-fieldContainer--stretchInputs t-Form-fieldContainer--large apex-item-wrapper apex-item-wrapper--select-list"
                      id="P31_SYSTEM_CONTAINER">
                      <div class="t-Form-labelContainer col col-2">
                        <label for="P31_SYSTEM" id="P31_SYSTEM_LABEL" class="t-Form-label">System</label>
                      </div>
                      <div class="t-Form-inputContainer col col-4">
                        <div class="t-Form-itemWrapper">
                          <select id="P31_SYSTEM" name="P31_SYSTEM" class="selectlist apex-item-select"
                            data-native-menu="false" size="1">
                            <option value="" selected="selected"></option>
                            <option value="Ayurveda">Ayurveda</option>
                            <option value="Homoeopathy">Homoeopathy</option>
                            <option value="Siddha">Siddha</option>
                            <option value="Siddha and Yoga &amp; Naturopathy">Siddha and Yoga &amp;
                              Naturopathy</option>
                            <option value="Unani">Unani</option>
                            <option value="Varma (Siddha)">Varma (Siddha)</option>
                            <option value="Yoga &amp; Naturopathy">Yoga &amp; Naturopathy</option>
                          </select>
                        </div>
                        <span id="P31_SYSTEM_error_placeholder" class="a-Form-error"
                          data-template-id="428237130780249931341_ET"></span>
                      </div>
                    </div>
                  </div>
                  <div class="col col-6 apex-col-auto col-end">
                    <div
                      class="t-Form-fieldContainer rel-col t-Form-fieldContainer--stretchInputs t-Form-fieldContainer--large apex-item-wrapper apex-item-wrapper--select-list"
                      id="P31_QUARTERS_CONTAINER">
                      <div class="t-Form-labelContainer col col-2">
                        <label for="P31_QUARTERS" id="P31_QUARTERS_LABEL" class="t-Form-label">Quarters</label>
                      </div>
                      <div class="t-Form-inputContainer col col-4">
                        <div class="t-Form-itemWrapper">
                          <select id="P31_QUARTERS" name="P31_QUARTERS" class="selectlist apex-item-select"
                            data-native-menu="false" size="1">
                            <option value="" selected="selected"></option>
                            <option value="1st Quarter">1st Quarter</option>
                            <option value="2nd Quarter">2nd Quarter</option>
                            <option value="3rd Quarter">3rd Quarter</option>
                            <option value="4th Quarter">4th Quarter</option>
                            <option value="Annual Indent">Annual Indent</option>
                          </select>
                        </div>
                        <span id="P31_QUARTERS_error_placeholder" class="a-Form-error"
                          data-template-id="428237130780249931341_ET"></span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row ">
                  <div class="col col-6 apex-col-auto col-start"><button class="t-Button u-color-12" type="button"
                      id="searchBtn"><span class="t-Button-label">Search</span></button></div>
                  <div class="col col-6 apex-col-auto col-end"><button class="t-Button js-ignoreChange" type="button"
                      id="clearBtn"><span class="t-Button-label">Clear</span></button></div>
                </div>
                <div class="row ">
                  <div class="col col-12 apex-col-auto col-start col-end">
                    <div id="R311562979901797611632" role="region" aria-label="Medicine Details"
                      class="t-IRR-region js-apex-region">
                      <div class="t-Region-orderBy"></div>
                      <div id="R311562979901797611632_ir" class="a-IRR-container">
                        <div id="R311562979901797611632_worksheet_region" class="a-IRR" aria-live="polite">
                          <div id="R311562979901797611632_single_row_view" class="a-IRR-singleRowView"></div>
                          <div id="R311562979901797611632_full_view" class="a-IRR-fullView">
                            <div id="R311562979901797611632_toolbar" class="a-IRR-toolbar">

                            </div>


                          </div>
                          <div role="region" aria-label="Chart view of Medicine Details"
                            id="R311562979901797611632_chart" class="a-IRR-chartView"></div>
                          <div role="region" aria-label="Group by view of Medicine Details"
                            id="R311562979901797611632_group_by" class="a-IRR-groupByView"></div>
                          <div role="region" aria-label="Pivot view of Medicine Details"
                            id="R311562979901797611632_pivot" class="a-IRR-pivotView">
                            <div class="a-IRR-tableContainer">
                              <div class="t-fht-wrapper">
                                <div class="t-fht-thead js-stickyTableHeader js-stickyWidget-toggle"
                                  id="stickyTableHeader_1"
                                  style="z-index: 300; width: 1061.85px; position: absolute; top: auto;">
                                  <div id="pivotContainer"></div>
                                  <!-- <table id="pivotTable" class="display" style="width:100%">
                                        <thead></thead>
                                        <tbody></tbody>
                                      </table> -->
                                </div>
                                <div class="js-stickyWidget-placeholder" style="width: 1061.85px; height: 72px;">
                                </div>

                              </div>
                            </div>
                          </div>
                          <div role="region" aria-label="Data view of Medicine Details"
                            id="R311562979901797611632_data_panel" class="a-IRR-reportView"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
      </main>
    </div>
    <div class="t-Body-inlineDialogs" id="t_Body_inlineDialogs"></div>
    <input type="hidden" id="pPageFormRegionChecksums" value="[]">
    <input type="hidden" id="pPageItemsRowVersion" value=""><input type="hidden" id="pPageItemsProtected"
      value="/yYCh-Kmo7Auw7FhSGyrLGKCtb3MJBSD4PtQe8BXME-y7tiWCZh1SkoqBfvF5no3Vfx9V7JHNvC5tSA2JonAWUw">
  </form>

  <!-- jQuery -->
  <script src="../assets/js/jquery-3.6.0.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="../assets/js/widget.treeView.min.js"></script>
  <script src="../assets/common.js"></script>
  <script src="../assets/js/widget.interactiveReport.min.js"></script>
  <script src="../assets/js/widget.iconList.min.js"></script>
  <script src="../assets/js/widget.stickyTableHeader.min.js"></script>
  <script src="../assets/js/widget.stickyWidget.min.js"></script>
  <script src="../assets/js/item.Colorpicker.min.js"></script>
  <script src="../assets/js/jetCommonBundle.min.js"></script>
  <script src="../assets/js/chartBundle.min.js"></script>

  <script src="../assets/js/toastUtil.js"></script>
  <script type="module" src="../assets/js/dataTableUtil.js"></script>
  <script type="module" src="../assets/js/buildAndRenderPivotTableIns.js"></script>
  <script src="../assets/js/crypto-js.min.js"></script>
  <script src="../assets/js/theme42.min.js"></script>
  <script src="../assets/js/global.js"></script>
  <script src="../assets/js/encrypt_decrypt.js"></script>
  <script src="../assets/js/singleFileUpload.js"></script>
  <script src="../assets/js/globalHeader.js"></script>
  <script src="../assets/js/validateField.js"></script>

  <script>
    let dataTableRef;

    $(document).ready(function () {
      let uploadFile = null;
      let uploadPayload = null;
      const apiUrl = 'https://tngis.tnega.org/medical_indent_api/v1/commonfunction';
      // const userId = localStorage.getItem('userId');
      // const secretKey = 'V7gN4dY8pT2xB3kRz';
      const district = localStorage.getItem('userDistrict');
      const designation = localStorage.getItem('userDesignation') || '';

      const username = localStorage.getItem('userName');
      const mobnumber = localStorage.getItem('userMobileNumber') || '9941256207';
      $('#P1_NAME_OF_THE_INDENTING_OFFICER_DISPLAY').text(username);
      $('#P1_NAME_OF_THE_INDENTING_OFFICER').val(username);
      $('#P1_DISTRICT_DISPLAY').text(district);
      $('#P1_DISTRICT').val(district);

      function fetchAndPopulateDropdown({ payload, dropdownId, placeholder }) {
        $.ajax({
          url: apiUrl,
          method: 'POST',
          headers: {
            'X-APP-Key': 'edm',
            'X-APP-Name': 'edm'
          },
          data: {
            data: encryptData(payload)
          },
          dataType: 'json',
          success(response) {
            const decrypted = decryptData(response.data);
            console.log(`Decrypted Data for ${payload.function_name}:`, decrypted);

            const $dropdown = $(`#${dropdownId}`);
            $dropdown.empty().append(`<option value="">${placeholder}</option>`);

            decrypted.forEach(item => {
              const value = item.district || item.p_size || item.im_medicine_price_fn || item.medicine || item.year || item.system || item.quarter;
              $dropdown.append(`<option value="${value}">${value}</option>`);
            });
          },
          error(xhr, status, error) {
            console.error(`${payload.function_name} API Error:`, error);
          }
        });
      }


      fetchAndPopulateDropdown({
        payload: {
          action: "function_call",
          function_name: "im_own_district_fn",
          params: { null: null }
        },
        dropdownId: "P31_DISTRICT",
        placeholder: "--Select District Name--"
      });


      fetchAndPopulateDropdown({
        payload: {
          action: "function_call",
          function_name: "im_year_fn",
          params: {}
        },
        dropdownId: "P31_FINANCIAL_YEAR",
        placeholder: "--Select Financial Year--"
      });

      fetchAndPopulateDropdown({
        payload: {
          action: "function_call",
          function_name: "im_system_fn",
          params: { null: null }
        },
        dropdownId: "P31_SYSTEM",
        placeholder: "--Select System--"
      });

      fetchAndPopulateDropdown({
        payload: {
          action: "function_call",
          function_name: "im_quarter_fn",
          params: {}
        },
        dropdownId: "P31_QUARTERS",
        placeholder: "--Select Quarters--"
      });




      function fetchTableData() {
        const payload = {
          action: "function_call",
          function_name: "get_outsource_indent_summary",
          params: {
            p_district: $('#P31_DISTRICT').val() || '',
            p_financial_year: $('#P31_FINANCIAL_YEAR').val() || '',
            p_system: $('#P31_SYSTEM').val() || '',
            p_quarters: $('#P31_QUARTERS').val() || '',
          }
        };
        $.ajax({
          url: apiUrl,
          method: 'POST',
          headers: {
            'X-APP-Key': 'edm',
            'X-APP-Name': 'edm'
          },
          data: {
            data: encryptData(payload)
          },
          dataType: 'json',
          success(response) {
            if (response.success === 0 || response.message === "Data not found") {
              if ($.fn.DataTable.isDataTable('#pivotTable')) {
                $('#pivotTable').DataTable().clear().destroy();
              }
              $('#pivotContainer').html('<div class="text-center">No Data Found</div>');
              return;
            }

            const data = decryptData(response.data);

            if (!Array.isArray(data) || data.length === 0) {
              if ($.fn.DataTable.isDataTable('#pivotTable')) {
                $('#pivotTable').DataTable().clear().destroy();
              }
              $('#pivotContainer').html('<div class="text-center">No Data Found</div>');
              return;
            }
            generatePivotTable(data, 'pivotContainer');
          },
          error(xhr, status, error) {
            console.error(`${payload.function_name} API Error:`, error);
          }
        });

      }

      $('#searchBtn').on('click', function () {
        const financialYear = $('#P31_FINANCIAL_YEAR').val();
        const district = $('#P31_DISTRICT').val();


        if (!financialYear || !district) {
          showErrorToast("Please select both Financial Year and District.");
          return;
        }
        fetchTableData();

      });

      $('#clearBtn').on('click', function () {
        $('#P31_FINANCIAL_YEAR').val('');
        $('#P31_DISTRICT').val('');
      });


    });
  </script>
</body>

</html>