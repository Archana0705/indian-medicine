<html class="page-9 app-IMIM" lang="en" style="--js-sticky-top: 204.375px;">

<head>
  <meta http-equiv="x-ua-compatible" content="IE=edge">
  <meta charset="utf-8">
  <title>STOCK DETAILS</title>

  <link rel="apple-touch-icon" href="../assets/img/app-icon-192.png">
  <link rel="icon" href="../assets/img/app-icon-32.png">

  <link rel="stylesheet" href="../assets/css/Core.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/Theme-Standard.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/font-apex.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/Core_theme.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/custom.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/aos.min.css" type="text/css">
  <link rel="stylesheet" href="../assets/css/theme.css" type="text/css">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="../assets/vendor/datatable/css/dataTables.css" rel="stylesheet">
  <link rel="stylesheet" href="../assets/vendor/datatable/dataTables.bootstrap5.min.css">
  <link href="../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="-1">
  <meta http-equiv="Cache-Control" content="no-cache">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style type="text/css">
    .t-fht-cell {
      height: 1px;
      overflow: hidden;
    }

    .t-fht-wrapper {
      width: 100%;
      overflow: hidden;
      position: relative;
    }

    .t-fht-thead {
      overflow: hidden;
      position: relative;
    }

    .t-fht-tbody {
      overflow: auto;
    }
  </style>
</head>

<body
  class="t-PageBody t-PageBody--hideLeft t-PageBody--hideActions t-PageTemplate--standard apex-top-nav apex-icons-fontapex apex-theme-vita-standard js-HeaderExpanded t-PageBody--topNav"
  id="t_PageBody" data-aos-easing="ease" data-aos-duration="400" data-aos-delay="0">
  <a href="#main" id="t_Body_skipToContent">Skip to Main Content</a>
  <form>
    <header class="t-Header" id="t_Header" role="banner">
      <div class="t-Header-branding">
        <div class="t-Header-controls">
          <button class="t-Button t-Button--icon t-Button--header t-Button--headerTree" aria-label="Main Navigation"
            title="Main Navigation" id="t_Button_navControl" type="button"><span class="t-Header-controlsIcon"
              aria-hidden="true"></span></button>
        </div>
        <div class="t-Header-logo">
          <!-- <a href="&#x2F;ords&#x2F;r&#x2F;dimdev&#x2F;imim&#x2F;home?session=16050898105778" class="t-Header-logo-link"><img src="r&#x2F;dimdev&#x2F;117&#x2F;files&#x2F;static&#x2F;v194&#x2F;app-251298-logo.jpeg" alt="" class="apex-logo-img" /><span class="apex-logo-text">DIRECTORATE OF INDIAN MEDICINE  - INDENT MANAGEMENT</span></a> -->
          <div class="gigw">
            <li><a data-aos="fade-up" data-aos-delay="200" class="linkedin btn-decrease aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="font size Decrease"><i></i> A
                  -</span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="300" class="linkedin btn-orig aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Reset font"><i></i> A
                  <sup></sup></span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="400" class="instagram btn-increase aos-init aos-animate"><span
                  class="d-inline-block" tabindex="0" data-toggle="tooltip" title="font size Increase"><i></i> A
                  +</span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="500" class="aos-init aos-animate"><span class="d-inline-block"
                  tabindex="0" data-toggle="tooltip" title="Dark Mode"><i class="t-Icon fa fa-moon-o"
                    id="darkmode"></i></span></a></li>
            <li><a data-aos="fade-up" data-aos-delay="600" class="form-check form-switch aos-init aos-animate"><label
                  class="form-check-label" for="screenReaderSwitch">
                  <span class="d-inline-block" tabindex="0" data-toggle="tooltip" title="Screen Reader">
                    <i id="sound" class="t-Icon fa fa-volume-up"></i></span></label><input class="form-check-input"
                  type="checkbox" role="switch" id="screenReaderSwitch"
                  onclick="readText(document.getElementsByTagName('body')[0])"></a>
            </li>
          </div>
        </div>
        <div class="t-Header-navBar">
          <div class="t-Header-navBar--start"></div>
          <div id="globalHeader"></div>
          <div class="t-Header-navBar--end"></div>
        </div>
      </div>
      <div class="top">
        <img id="leftlogo" data-aos="fade-right" data-aos-duration="800" src="../assets/img/head-tnlogo.png"
          class="aos-init aos-animate">
        <h1 data-aos="zoom-in" data-aos-duration="800" class="dept-name text-middle aos-init aos-animate">Medicine
          Indent</h1>
        <h3 data-aos="zoom-in" data-aos-duration="800" class="dept-name2 text-middle aos-init aos-animate">Department of
          Indian Medicine and Homoeopathy</h3>
        <img id="rightlogo" data-aos="fade-left" data-aos-duration="800" src="../assets/img/head-dept-logo.png"
          class="aos-init aos-animate">
      </div>
      <!-- <div class="t-Header-nav">
        <div class="t-Header-nav-list js-tabLike js-tabLike a-MenuBar a-MenuBar--overflow a-MenuBar--tabs"
          id="t_MenuNav" role="menubar">
          <ul role="none">
            <li role="none" id="t_MenuNav_0" class="a-MenuBar-item a-Menu--current"><a role="menuitem"
                class="a-MenuBar-label" aria-current="true" id="t_MenuNav_0i" href="../amo/home.html">Home</a></li>
            <li role="none" id="t_MenuNav_1" class="a-MenuBar-item"><a role="menuitem" class="a-MenuBar-label"
                id="t_MenuNav_1i" href="../amo/received-medicine.html" tabindex="-1">Received Medicine Report </a></li>
            <li role="none" id="t_MenuNav_2" class="a-MenuBar-item"><a role="menuitem" class="a-MenuBar-label"
                id="t_MenuNav_2i" href="../amo/patient-details.html" tabindex="-1">Patient Details</a></li>
          </ul>
        </div>
      </div> -->
      <div class="t-Header-nav">
        <div class="t-Header-nav-list js-tabLike js-tabLike a-MenuBar a-MenuBar--overflow a-MenuBar--tabs"
          id="t_MenuNav" role="menubar">
          <ul id="nav-links">
            <div id="navbar-container"></div>

          </ul>
        </div>
      </div>

    </header>
    <div class="t-Body">
      <div class="t-Body-main">
        <div class="t-Body-title" id="t_Body_title"></div>
        <div class="t-Body-content" id="t_Body_content">
          <div id="t_Body_content_offset"></div>
          <main id="main" class="t-Body-mainContent">
            <span id="APEX_SUCCESS_MESSAGE" data-template-id="238562751400702882270_S"
              class="apex-page-success u-hidden"></span><span id="APEX_ERROR_MESSAGE"
              data-template-id="238562751400702882270_E" class="apex-page-error u-hidden"></span>
            <div class="t-Body-fullContent"></div>
            <div class="t-Body-contentInner">
              <div class="container">
                <div class="row ">
                  <div class="col col-12 apex-col-auto col-start col-end"><a href="../amo/home.html"
                      class="t-Button js-ignoreChange u-color-12" type="button" id="B428604350632300879542"><span
                        class="t-Button-label">Back</span></a></div>
                </div>
                <div class="row ">
                  <div class="col col-12 apex-col-auto col-start col-end">
                    <div id="R428611361524938769651" role="region" aria-label="STOCK DETAILS"
                      class="t-IRR-region t-IRR-region--noBorders js-showMaximizeButton js-apex-region">
                      <div class="t-Region-orderBy"></div>
                      <div id="R428611361524938769651_ir" class="a-IRR-container">
                        <div id="R428611361524938769651_worksheet_region" class="a-IRR" aria-live="polite">
                          <div id="R428611361524938769651_single_row_view" class="a-IRR-singleRowView"></div>
                          <div id="R428611361524938769651_full_view" class="a-IRR-fullView">
                            <div id="R428611361524938769651_toolbar" class="a-IRR-toolbar">
                              <div role="search" aria-label="Search bar of STOCK DETAILS"
                                id="R428611361524938769651_toolbar_controls" class="a-IRR-controls">
                                <div class="a-IRR-controlGroup a-IRR-controlGroup--search a-IRR-controlGroup--hidden">
                                  <div class="a-IRR-search"><input type="hidden"
                                      id="R428611361524938769651_column_search_current_column"><input type="hidden"
                                      id="R428611361524938769651_search_field" value=""></div>
                                </div>
                                <div class="a-IRR-controlGroup a-IRR-controlGroup--views"></div>
                                <div class="a-IRR-controlGroup a-IRR-controlGroup--options">
                                  <input type="hidden" id="R428611361524938769651_row_select" value="50">
                                  <div class="a-IRR-actions"><button id="R428611361524938769651_actions_button"
                                      class="a-Button a-IRR-button a-IRR-button--actions" type="button"
                                      data-menu="R428611361524938769651_actions_menu" aria-haspopup="menu">Actions<span
                                        aria-hidden="true" class="a-Icon icon-menu-drop-down"></span></button></div>
                                </div>
                              </div>
                              <div role="region" aria-label="Buttons next to search bar of STOCK DETAILS"
                                class="a-IRR-buttons">
                                <button type="button" class="t-Button t-Button--hot js-ignoreChange u-color-12"
                                  id="openPatientLogBtn">
                                  Add
                                </button>
                                </button>
                              </div>
                            </div>
                            <!-- Bootstrap Modal -->
                            <!-- <div class="modal fade" id="patientLogModal" tabindex="-1"
                          aria-labelledby="patientLogModalLabel" aria-hidden="true">
                          <div class="modal-dialog modal-lg modal-dialog-scrollable"> -->
                            <div class="modal fade" id="patientLogModal" tabindex="-1" aria-hidden="true">
                              <div class="modal-dialog modal-lg modal-dialog-scrollable">
                                <div class="modal-content">
                                  <div class="modal-header">
                                    <h5 class="modal-title" id="patientLogModalLabel">PATIENT LOG - DETAILS</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                      aria-label="Close"></button>
                                  </div>

                                  <div class="modal-body">
                                    <form id="patientForm">



                                      <div class="container">
                                        <div class="row ">
                                          <div class="col col-12 apex-col-auto col-start col-end">
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel apex-item-wrapper apex-item-wrapper--select-list js-show-label is-required"
                                              id="P10_INSTITUTION_NAME_CONTAINER">
                                              <div class="t-Form-labelContainer">
                                                <label for="P10_INSTITUTION_NAME" id="P10_INSTITUTION_NAME_LABEL"
                                                  class="t-Form-label">Institution Name</label>
                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper">
                                                  <select id="P10_INSTITUTION_NAME" name="P10_INSTITUTION_NAME"
                                                    required="" class="selectlist apex-item-select"
                                                    data-native-menu="false" size="1">
                                                  </select>
                                                </div>
                                                <div class="t-Form-itemAssistance">
                                                  <span id="P10_INSTITUTION_NAME_error_placeholder" class="a-Form-error"
                                                    data-template-id="428237131750063931341_ET"></span>
                                                  <div class="t-Form-itemRequired" aria-hidden="true">Required</div>
                                                </div>
                                              </div>
                                            </div><input type="hidden" name="P10_SLNO" id="P10_SLNO" value="">
                                          </div>
                                        </div>
                                        <div class="row ">
                                          <div class="col col-12 apex-col-auto col-start col-end">
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel apex-item-wrapper apex-item-wrapper--select-list js-show-label is-required"
                                              id="P10_MEDICINE_NAME_CONTAINER">
                                              <div class="t-Form-labelContainer">
                                                <label for="P10_MEDICINE_NAME" id="P10_MEDICINE_NAME_LABEL"
                                                  class="t-Form-label">Medicine Name</label>
                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper"><select id="P10_MEDICINE_NAME"
                                                    name="P10_MEDICINE_NAME" required=""
                                                    class="selectlist apex-item-select" data-native-menu="false"
                                                    size="1">

                                                  </select></div><span id="P10_MEDICINE_NAME_error_placeholder"
                                                  class="a-Form-error"
                                                  data-template-id="428237131010283931341_ET"></span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="row ">
                                          <div class="col col-12 apex-col-auto col-start col-end">
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel apex-item-wrapper apex-item-wrapper--select-list js-show-label is-required"
                                              id="P10_PACKAGE_SIZE_CONTAINER">
                                              <div class="t-Form-labelContainer">
                                                <label for="P10_PACKAGE_SIZE" id="P10_PACKAGE_SIZE_LABEL"
                                                  class="t-Form-label">Package Size</label>
                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper"><select id="P10_PACKAGE_SIZE"
                                                    name="P10_PACKAGE_SIZE" required=""
                                                    class="selectlist apex-item-select" data-native-menu="false"
                                                    size="1">
                                                    <option value="" selected="selected">Select</option>
                                                  </select></div><span id="P10_PACKAGE_SIZE_error_placeholder"
                                                  class="a-Form-error"
                                                  data-template-id="428237131010283931341_ET"></span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="row ">
                                          <div class="col col-12 apex-col-auto col-start col-end">
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel apex-item-wrapper apex-item-wrapper--text-field is-required"
                                              id="P10_QUANTITY_CONTAINER">
                                              <div class="t-Form-labelContainer">
                                                <label for="P10_QUANTITY" id="P10_QUANTITY_LABEL"
                                                  class="t-Form-label">Quantity</label>
                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper"><input type="text" id="P10_QUANTITY"
                                                    name="P10_QUANTITY" required="" class="text_field apex-item-text"
                                                    value="" size="30" maxlength="1000"></div><span
                                                  id="P10_QUANTITY_error_placeholder" class="a-Form-error"
                                                  data-template-id="428237131010283931341_ET"></span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="row ">
                                          <div class="col col-12 apex-col-auto col-start col-end">
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel apex-item-wrapper apex-item-wrapper--text-field is-required"
                                              id="P10_BATCH_NO_CONTAINER">
                                              <div class="t-Form-labelContainer">
                                                <label for="P10_BATCH_NO" id="P10_BATCH_NO_LABEL"
                                                  class="t-Form-label">Batch No</label>
                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper"><input type="text" id="P10_BATCH_NO"
                                                    name="P10_BATCH_NO" required="" class="text_field apex-item-text"
                                                    value="" size="30" maxlength="1000"></div><span
                                                  id="P10_BATCH_NO_error_placeholder" class="a-Form-error"
                                                  data-template-id="428237131010283931341_ET"></span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>
                                        <div class="row">
                                          <div class="col col-12">
                                            <label for="P10_EXPIRY_DATE" id="P10_EXPIRY_DATE_LABEL"
                                              class="t-Form-label">Expiry Date</label>
                                            <div
                                              class="t-Form-fieldContainer t-Form-fieldContainer--floatingLabel is-required"
                                              id="P10_EXPIRY_DATE_CONTAINER">
                                              <div class="t-Form-labelContainer mb-1">

                                              </div>
                                              <div class="t-Form-inputContainer">
                                                <div class="t-Form-itemWrapper">
                                                  <input type="date" class="form-control apex-item-text"
                                                    id="P10_EXPIRY_DATE" name="P10_EXPIRY_DATE"
                                                    aria-labelledby="P10_EXPIRY_DATE_LABEL" required />
                                                </div>
                                                <span id="P10_EXPIRY_DATE_error_placeholder"
                                                  class="a-Form-error text-danger small"></span>
                                              </div>
                                            </div>
                                          </div>
                                        </div>

                                    </form>
                                  </div>

                                  <div class="modal-footer">
                                    <button type="button" class="t-Button btn-bgclr"
                                      data-bs-dismiss="modal">Cancel</button>
                                    <button type="submit" form="patientForm" id="submitBtn"
                                      class="t-button btn-bgclr">Submit</button>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </main>
          <footer class="t-Footer" id="t_Footer" role="contentinfo">
            <div class="t-Footer-body">
              <div class="t-Footer-content"></div>
              <div class="t-Footer-apex">
                <!-- <div class="t-Footer-version">    </div>
                    <div class="t-Footer-customize"></div>
                     -->
                <div class="row">
                  <div class="col-6">
                    <p class="text-middle"><img class="footer-logo" src="../assets/img/head-dept-logo.png"><br>Content
                      owned by Department of Indian Medicine and Homoeopathy Â©</p>
                  </div>
                  <div class="col-6">
                    <p class="text-middle"><img class="footer-logo" src="../assets/img/tnegalogo.png"><br>Designed and
                      Developed by Tamil Nadu e-Governance Agency</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="t-Footer-top">
              <a href="#top" class="t-Footer-topButton" id="t_Footer_topButton" title="Start of page"
                aria-label="Start of page"><span class="a-Icon icon-up-chevron" aria-hidden="true"></span></a>
            </div>
          </footer>
        </div>
      </div>
    </div>
    <div class="t-Body-inlineDialogs" id="t_Body_inlineDialogs"></div>
    <input type="hidden" id="pPageFormRegionChecksums" value="[]">
    <input type="hidden" id="pPageItemsRowVersion" value=""><input type="hidden" id="pPageItemsProtected"
      value="/If4R2Oy6neMAP8h4vpMy2iFpNrMnJPpBteNhkWOim6f8s2zKKs9TUCzBw3PPSeTZCIHPgcuVT6hueVTbEHClsQ">
  </form>
  <!-- jQuery -->
  <script src="../assets/js/jquery-3.6.0.min.js"></script>
  <script src="../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- DataTables -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="../assets/js/widget.treeView.min.js"></script>
  <!-- <script type="module" src="../assets/js/commonMenu.js"></script> -->
  <script src="../assets/common.js">
  </script>
  <script src="../assets/js/widget.interactiveReport.min.js"></script>
  <script src="../assets/js/widget.iconList.min.js"></script>
  <script src="../assets/js/widget.stickyTableHeader.min.js"></script>
  <script src="../assets/js/widget.stickyWidget.min.js"></script>
  <script src="../assets/js/item.Colorpicker.min.js"></script>
  <script src="../assets/js/jetCommonBundle.min.js"></script>
  <script src="../assets/js/chartBundle.min.js"></script>

  <script src="../assets/js/toastUtil.js"></script>
  <script type="module" src="../assets/js/dataTableUtil.js"></script>
  <script src="../assets/js/crypto-js.min.js"></script>
  <script src="../assets/js/theme42.min.js"></script>
  <script src="../assets/js/global.js"></script>
  <script src="../assets/js/encrypt_decrypt.js"></script>
  <script src="../assets/js/singleFileUpload.js"></script>
  <script src="../assets/js/globalHeader.js"></script>
  <!-- <script>
    $(document).ready(function () {
      $('#P10_EXPIRY_DATE_picker').datepicker({
        format: 'mm/dd/yyyy',
        todayHighlight: true,
        autoclose: true
      });
    });
  </script> -->

  <script>
    let dataTableRef;

    $(document).ready(function () {
      let uploadFile = null;
      let uploadPayload = null;
      const apiUrl = 'https://tngis.tnega.org/medical_indent_api/v1/commonfunction';
      // const userId = localStorage.getItem('userId');
      // const secretKey = 'V7gN4dY8pT2xB3kRz';
      // const district = localStorage.getItem('userDistrict');
      // const username = localStorage.getItem('userName');
      const mobnumber = localStorage.getItem('userMobileNumber') || '9941256207';

      const district = localStorage.getItem('userDistrict');
      const nameOfTheInstitution = localStorage.getItem('userInstitutionName');
      const system = localStorage.getItem('userSystem');
      $('#openPatientLogBtn').off('click').on('click', function (event) {
        event.preventDefault();

        const modalInstance = bootstrap.Modal.getOrCreateInstance(document.getElementById('patientLogModal'));
        modalInstance.show();

        function fetchAndPopulateDropdown({ payload, dropdownId, placeholder }) {
          $.ajax({
            url: apiUrl,
            method: 'POST',
            headers: {
              'X-APP-Key': 'edm',
              'X-APP-Name': 'edm'
            },
            data: {
              data: encryptData(payload)
            },
            dataType: 'json',
            success(response) {
              const decrypted = decryptData(response.data);
              console.log(`Decrypted Data for ${payload.function_name}:`, decrypted);

              const $dropdown = $(`#${dropdownId}`);
              $dropdown.empty().append(`<option value="">${placeholder}</option>`);

              decrypted.forEach(item => {
                const value = item.p_institude || item.p_size || item.im_medicine_price_fn || item.gender || item.medicine;
                $dropdown.append(`<option value="${value}">${value}</option>`);
              });
            },
            error(xhr, status, error) {
              console.error(`${payload.function_name} API Error:`, error);
            }
          });
        }

        if (nameOfTheInstitution) {
          const nameOfTheInstitutionSelect = $('#P10_INSTITUTION_NAME');
          nameOfTheInstitutionSelect.append(`<option value="${nameOfTheInstitution}" selected>${nameOfTheInstitution}</option>`);
        } else {
          console.warn('Institution not found in localStorage');
        }

        if (nameOfTheInstitution) {
          fetchAndPopulateDropdown({
            payload: {
              action: "function_call",
              function_name: "im_medicine_name_fn",
              params: { institution_name: nameOfTheInstitution }
            },
            dropdownId: "P10_MEDICINE_NAME",
            placeholder: "--Select Medicine Name--"
          });
        }
        $('#P10_MEDICINE_NAME').off('change').on('change', function () {
          const selectedMedicine = $(this).val();

          if (selectedMedicine) {
            fetchAndPopulateDropdown({
              payload: {
                action: "function_call",
                function_name: "im_pack_size_fn",
                params: { institution_name: selectedMedicine }
              },
              dropdownId: "P10_PACKAGE_SIZE",
              placeholder: "--Select Packing size--"
            });
          } else {
            // Clear medicine dropdown if no institution selected
            $('#P10_PACKAGE_SIZE').empty().append('<option value="">--Select Packing Size--</option>');
          }
        });


      });

      $('#submitBtn').on('click', async function (event) {
        event.preventDefault();
        $('.field-error').remove();

        var nameOfTheInstitution = $('#P10_INSTITUTION_NAME').val()?.trim();
        var medicineName = $('#P10_MEDICINE_NAME').val()?.trim();
        var medicineQuantity = $('#P10_QUANTITY').val()?.trim();
        var medicinePackageSize = $('#P10_PACKAGE_SIZE').val()?.trim();
        var medicineBatchNo = $('#P10_BATCH_NO').val()?.trim();
        var medicineExpiryDate = $('#P10_EXPIRY_DATE').val()?.trim();
        // Basic validation function
        function showError(selector, message) {
          $(selector).after(`<div class="field-error" style="color:red;font-size:12px;">${message}</div>`);
        }

        let isValid = true;

        if (!nameOfTheInstitution) {
          showError('#P10_INSTITUTION_NAME', 'Institution name is required.');
          showErrorToast("Institution name is required.");
          isValid = false;
        }
        if (!medicineName) {
          showError('#P10_MEDICINE_NAME', 'Medicine name is required.');
          showErrorToast("Medicine name is required.");
          isValid = false;
        }
        if (!medicineQuantity || isNaN(medicineQuantity)) {
          showError('#P10_QUANTITY', 'Valid quantity is required.');
          showErrorToast("Valid quantity is required.");
          isValid = false;
        }
        if (!medicinePackageSize) {
          showError('#P10_PACKAGE_SIZE', 'Packing size is required.');
          showErrorToast("Packing size is required.");
          isValid = false;
        }
        if (!medicineBatchNo) {
          showError('#P10_BATCH_NO', 'Batch number is required.');
          showErrorToast("Batch number is required.");
          isValid = false;
        }
        if (!medicineExpiryDate) {
          showError('#P10_EXPIRY_DATE', 'Expiry date is required.');
          showErrorToast("Expiry date is required.");
          isValid = false;
        }


        if (!isValid) return;
        const payload = {
          action: "procedure_call",
          procedure_name: "im_stock_dtls_ins_sp",
          params: {
            p_medicine: medicineName,
            p_size: medicinePackageSize,
            p_qty: medicineQuantity,
            p_batch: medicineBatchNo,
            expiry_date: medicineExpiryDate,
            p_user: localStorage.getItem('userMobileNumber') || '9941256207',
            p_institude: nameOfTheInstitution,
          }
        };

        // API call
        $.ajax({
          url: apiUrl,
          method: "POST",
          headers: {
            'X-APP-Key': "edm",
            'X-APP-Name': "edm"
          },
          data: {
            data: encryptData(payload)
          },
          dataType: 'json',
          cache: false,
          success: function (response) {
            alert("Inserted Successfully");
          },
          error: function (xhr, status, error) {
            console.error("API call failed:", {
              status: xhr.status,
              statusText: xhr.statusText,
              responseText: xhr.responseText,
              error: error
            });
          }
        });

        console.log(payload);
      });


    });
  </script>
</body>

</html>